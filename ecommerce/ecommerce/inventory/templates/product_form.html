{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}

        <div class="mb-3">
            <label for="id_files">Upload Images / Videos</label>
            <input type="file" id="id_files" name="files" multiple accept="image/*,video/*">
        </div>

        <div id="preview" class="d-flex flex-wrap gap-2"></div>

        <button type="submit" class="btn btn-success mt-3">Save</button>
    </form>

    <script>
        const input = document.getElementById('id_files');
        const preview = document.getElementById('preview');

        input.addEventListener('change', () => {
            preview.innerHTML = '';
            Array.from(input.files).forEach((file, index) => {
                const fileContainer = document.createElement('div');
                fileContainer.style.position = 'relative';
                fileContainer.style.width = '120px';
                fileContainer.style.height = '120px';

                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '&times;';
                removeBtn.style.position = 'absolute';
                removeBtn.style.top = '0';
                removeBtn.style.right = '0';
                removeBtn.style.background = 'red';
                removeBtn.style.color = 'white';
                removeBtn.style.border = 'none';
                removeBtn.style.cursor = 'pointer';
                removeBtn.addEventListener('click', () => {
                    const dt = new DataTransfer();
                    Array.from(input.files).forEach((f, i) => {
                        if (i !== index) dt.items.add(f);
                    });
                    input.files = dt.files;
                    fileContainer.remove();
                });

                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    fileContainer.appendChild(img);
                } else {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.controls = true;
                    video.style.width = '100%';
                    video.style.height = '100%';
                    fileContainer.appendChild(video);
                }

                fileContainer.appendChild(removeBtn);
                preview.appendChild(fileContainer);
            });
        });
    </script>

</div>
{% endblock %}